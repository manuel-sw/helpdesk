<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <record id="view_ticket_project_form" model="ir.ui.view">
    <field name="name">view.ticket_project.form</field>
    <field name="model">helpdesk.ticket</field>
    <field name='inherit_id' ref='helpdesk_mgmt.ticket_view_form'/>
    <field name="arch" type="xml">
      <notebook position="inside">
        <page name="project" string="Project">
          <group>
            <field name="project_id" string="Project" />
            <field name="task_id" string="Task" />
          </group>
        </page>
      </notebook>
    </field>
  </record>

  <record id="view_helpdesk_ticket_kanban" model="ir.ui.view">
    <field name="name">helpdesk.ticket.kanban</field>
    <field name="model">helpdesk.ticket</field>
    <field name="priority" eval="100"/>
    <field name="arch" type="xml">
        <kanban class="o_kanban_mobile" archivable="false" default_group_by="stage_id">
          <field name="number"/>
          <field name="name"/>
          <field name="partner_name"/>
          <field name="user_id"/>
          <field name="color"/>
          <field name="stage_id"/>
          <field name="project_id"/>
          <field name="task_id"/>
          <field name="priority" widget="priority"/>
          <field name="assigned_date"/>
          <progressbar field="activity_state" colors="{&quot;planned&quot;: &quot;success&quot;, &quot;today&quot;: &quot;warning&quot;, &quot;overdue&quot;: &quot;danger&quot;}"/>
          <templates>
            <t t-name="kanban-box">
              <div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_card oe_kanban_global_click">
              <!--<div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_content oe_kanban_global_click">-->
                  <div class="o_dropdown_kanban dropdown" groups="base.group_user">
                      <a class="dropdown-toggle btn" role="button" data-toggle="dropdown" href="#">
                          <span class="fa fa-ellipsis-v" aria-hidden="true"/>
                      </a>
                      <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                          <li t-if="widget.editable"><a type="edit">Edit</a></li>
                          <li t-if="widget.deletable"><a type="delete">Delete</a></li>
                          <li class="divider"/>
                          <li>
                              <ul class="oe_kanban_colorpicker" data-field="color"/>
                          </li>
                      </ul>
                  </div>

                    <div class="o_kanban_record_top">
                      <div class="o_kanban_record_headings">
                        <strong class="o_kanban_record_title" style="font-weight: bold"><field name="number"/> - <field name="name"/></strong>
                        <small class="o_kanban_record_subtitle text-muted">
                          <field name="partner_id"/>
                        </small>
                        <div class="container o_kanban_card_content" t-if="record.project_id.raw_value != 'False'">
                          <div class="row">
                            <div class="col-12 p-0">
                              <span class="text-muted">Project</span>
                              <a name="link_project_view" type="object">
                                <span class="font-weight-bold"><field name="project_id"/></span>
                              </a>
                            </div>
                            <div class="col-12 p-0">
                              <span class="text-muted">Task</span>
                              <a name="link_task_view" type="object">
                                <span class="font-weight-bold"><field name="task_id"/></span>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="o_kanban_record_body">
                      <field name="priority" widget="priority"/>
                      <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                    </div>
                    <div class="o_kanban_record_bottom">
                      <div class="oe_kanban_bottom_left"/>
                      <div class="oe_kanban_bottom_right">
                        <field name="activity_ids" widget="kanban_activity" related="activity_state"/>
                        <field name="kanban_state" widget="state_selection"/>
                        <field name="activity_state" invisible="1"/>
                        <img t-att-src="kanban_image('res.users', 'image_128', record.user_id.raw_value)" t-att-title="record.user_id.value" width="24" height="24" class="oe_kanban_avatar" alt="Assigned user image"/>
                      </div>
                    </div>
                </div>
            </t>
          </templates>
        </kanban>
    </field>
  </record>

</odoo>
